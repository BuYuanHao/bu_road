# **MySQL函数**

##  **定义和作用**

    函数是一段可以重复使用的SQL代码，它接受输入参数并返回一个结果。函数主要用于计算数据、格式化数据或者转换数据类型等操作，以方便在查询中使用。

##   **分类**

- **聚合函数**：用于对一组数据进行计算并返回一个单一的值。例如，`SUM`用于计算总和，`AVG`用于计算平均值，`COUNT`用于计算记录数等。
- 例如，要计算一个订单表中所有订单的总金额，可以使用`SUM`函数：`SELECT SUM(order_amount) FROM orders;`。
- **字符串函数**：用于处理字符串类型的数据。例如，`CONCAT`函数用于拼接字符串，`SUBSTRING`函数用于提取字符串的一部分，`UPPER`和`LOWER`函数分别用于将字符串转换为大写和小写。
- 比如，将用户表中的名字和姓氏拼接成一个完整的姓名：`SELECT CONCAT(first_name, ' ', last_name) AS full_name FROM users;`。
- **日期和时间函数**：用于处理日期和时间类型的数据。例如，`CURRENT_DATE`返回当前日期，`DATE_ADD`用于在日期上添加一个时间间隔，`DATEDIFF`用于计算两个日期之间的差值。
- 例如，计算两个日期之间的天数差：`SELECT DATEDIFF('2024-10-30', '2024-10-20');`。
- **数学函数**：用于进行数学计算。例如，`ABS`函数返回一个数的绝对值，`ROUND`函数用于对数字进行四舍五入，`POWER`函数用于计算幂运算。
- 例如，对一个价格进行四舍五入：`SELECT ROUND(price, 2) FROM products;`（这里将价格保留两位小数）。

##   **自定义函数**

- 除了使用MySQL提供的内置函数，还可以创建自定义函数。自定义函数需要使用`CREATE FUNCTION`语句来定义，它包括函数名、参数列表、返回值类型和函数体。

- 例如，创建一个简单的自定义函数来计算两个数的平方和：
    ```sql
    DELIMITER //
    CREATE FUNCTION sum_of_squares(a INT, b INT) RETURNS INT
    BEGIN
        RETURN a * a + b * b;
    END //
    DELIMITER ;
    ```
- 定义好函数后，就可以像使用内置函数一样在查询中调用它：`SELECT sum_of_squares(3, 4);`。

# **MySQL存储过程**

## **定义和作用**

    - 存储过程是一组预编译的SQL语句，它存储在数据库中，可以被重复调用。存储过程类似于编程语言中的函数或方法，它可以接受输入参数、执行一系列的SQL操作，并可以返回结果。存储过程主要用于封装复杂的业务逻辑，提高数据库的性能和安全性。

## **基本结构**

- 存储过程包括过程名、参数列表（可以是输入参数、输出参数或者输入/输出参数）、变量声明、SQL语句块和异常处理等部分。
- 例如，创建一个简单的存储过程来插入一条用户记录：

    ```sql
    DELIMITER //
    CREATE PROCEDURE insert_user(IN user_name VARCHAR(255), IN user_email VARCHAR(255))
    BEGIN
        INSERT INTO users (name, email) VALUES (user_name, user_email);
    END //
    DELIMITER ;
    ```

## **调用和执行**

- 存储过程可以使用`CALL`语句来调用。例如，调用上面创建的插入用户记录的存储过程：`CALL insert_user('John Doe', 'john.doe@example.com');`。

## **优势**

- **性能优化**：存储过程在数据库中是预编译的，减少了每次执行相同SQL语句的编译时间，从而提高了性能。
- **代码复用**：可以将常用的业务逻辑封装在存储过程中，方便在不同的应用程序或者查询中重复调用。
- **安全性提高**：通过存储过程，可以限制对数据库表的直接访问，只允许用户通过存储过程来执行特定的操作，从而提高了数据库的安全性。

## **参数类型**

- **输入参数（IN）**：用于将外部的值传递到存储过程内部，在存储过程内部可以读取和使用这些参数，但不能修改外部变量的值。
- **输出参数（OUT）**：用于将存储过程内部的值返回给外部调用者。在存储过程内部需要对输出参数进行赋值操作。
- **输入/输出参数（INOUT）**：既可以将外部的值传递到存储过程内部，又可以将存储过程内部的值返回给外部。这种参数类型比较灵活，但使用相对复杂。